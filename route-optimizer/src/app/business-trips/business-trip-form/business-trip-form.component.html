<form *ngIf="businessTripForm" [formGroup]="businessTripForm" id="field-container">
  <div class="row">
    <div class="col-xl-6">
      <div class="row">
        <div class="col">
          <mat-form-field>
            <input type="text" placeholder="Pracownik" aria-label="Assignee" matInput formControlName="assignee" [matAutocomplete]="auto" />
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
              <!-- If we're loading -->
              <mat-option *ngIf="businessTripForm.get('assignee').value?.length < 4">Wpisz przynajmniej 4 znaki... </mat-option>
              <mat-option class="loading" *ngIf="availableEmployees.loading | async">
                <mat-spinner diameter="35"></mat-spinner>
              </mat-option>
              <!-- If we're not loading AND the array length is 0, show this -->
              <mat-option
                *ngIf="
                  availableEmployees.results.length === 0 &&
                  (availableEmployees.loading | async) === false &&
                  businessTripForm.get('assignee').value.length >= 4
                "
              >
                Brak pracowników spełniających podane kryteria.
              </mat-option>
              <!-- Actual payload -->
              <ng-container *ngIf="(availableEmployees.loading | async) === false">
                <mat-option *ngFor="let result of availableEmployees.results" [value]="result">
                  {{ result.firstName }} {{ result.lastName }}
                </mat-option>
              </ng-container>
            </mat-autocomplete>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field>
            <input matInput [matDatepicker]="startDatePicker" placeholder="Data rozpoczęcia" formControlName="startDate" />
            <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
            <mat-error *ngIf="businessTripForm.get('startDate').invalid">
              Wprowadź datę rozpoczęcia
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field>
            <input matInput [matDatepicker]="finishDatePicker" placeholder="Data zakończenia" formControlName="finishDate" />
            <mat-datepicker-toggle matSuffix [for]="finishDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #finishDatePicker></mat-datepicker>
            <mat-error *ngIf="businessTripForm.get('finishDate').invalid">
              Wprowadź datę zakończenia
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field>
            <input type="number" matInput placeholder="Limit kilometrów jednego dnia" formControlName="maxDistance" />
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button
            type="submit"
            class="btn btn btn-primary"
            [disabled]="!businessTripForm.valid || !submitButtonEnabled"
            (click)="sendForm()"
          >
            {{ submitButton }}
          </button>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div id="requistions" *ngIf="requistions.length > 0">
        <div class="row">
          <div class="col">
            <mat-checkbox (change)="onAllCheckChange($event)">Zaznacz wszystko</mat-checkbox>
          </div>
        </div>
        <div class="row" *ngFor="let requistion of requistions">
          <div class="col">
            <mat-checkbox (change)="onCheckChange($event)" [value]="requistion" [checked]="isRequistionChecked(requistion)">
              <span>{{ requistion.company.nameShort }} - zysk {{ requistion.estimatedProfit | number }} zł</span>
            </mat-checkbox>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
